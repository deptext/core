# Quickstart: Understanding Finalize Outputs

This guide explains the outputs generated by the finalize processor after a successful build.

## What is the Finalize Processor?

The finalize processor runs automatically at the end of every seed build. It:

1. Collects timing data from all processors
2. Scans published output directories for file counts and sizes
3. Generates two summary files: `README.md` and `bloom.json`

Unlike other processors, finalize's outputs appear **directly alongside your seed.nix file** (not in a subfolder).

## Output Files

After running `nix build -f seed.nix`, you'll find these new files:

```text
nursery/rust/s/se/serde/1.0.228/
├── seed.nix          # Your seed file (unchanged)
├── README.md         # NEW: Human-readable summary
├── bloom.json        # NEW: Machine-readable metadata
├── stats/            # Other processor outputs (if persist=true)
│   └── stats.json
└── ...
```

## README.md

The README provides a quick overview for humans browsing the repository:

```markdown
# serde v1.0.228

**Language**: Rust
**Last Build**: 2025-11-28T12:00:00Z
**Build Duration**: 5m 42.15s

## Processors

| Processor | Active | Published | Duration | Files | Size |
|-----------|--------|-----------|----------|-------|------|
| package-download | ✓ | - | 4m 11.76s | - | - |
| source-download | ✓ | - | 45.23s | - | - |
| stats | ✓ | [view output](./stats/) | 12.05s | 1 | 47.19 KB |
```

### Understanding the Table

| Symbol | Meaning |
|--------|---------|
| ✓ | Processor ran successfully |
| ✗ | Processor was disabled |
| - | Not applicable (e.g., no files for unpublished processor) |
| `[view output](./path/)` | Click to browse published files |

## bloom.json

The bloom.json file contains structured metadata for tooling and LLM context:

```json
{
  "pname": "serde",
  "version": "1.0.228",
  "language": "rust",
  "hash": "sha256:04xwh16jm7szizkkhj637jv23i5x8jnzcfrw6bfsrssqkjykaxcm",
  "github": {
    "owner": "serde-rs",
    "repo": "serde",
    "rev": "v1.0.228",
    "hash": "sha256:0qaz2mclr5cv3s5riag6aj3n3avirirnbi7sxpq4nw1vzrq09j6l"
  },
  "lastBuild": "2025-11-28T12:00:00Z",
  "buildDuration": 342150,
  "processors": {
    "package-download": { "active": true, "published": false, "buildDuration": 251755 },
    "source-download": { "active": true, "published": false, "buildDuration": 45230 },
    "stats": { "active": true, "published": true, "buildDuration": 12045, "fileCount": 1, "fileSize": 48320, "hash": "sha256:..." }
  }
}
```

### Key Fields

| Field | Description |
|-------|-------------|
| `pname` | Package name |
| `version` | Package version |
| `language` | "rust" or "python" |
| `buildDuration` | Total build time in milliseconds |
| `processors.[name].active` | Whether processor ran |
| `processors.[name].published` | Whether output was saved to disk |
| `processors.[name].buildDuration` | Processor time in milliseconds |
| `processors.[name].fileCount` | Number of published files |
| `processors.[name].fileSize` | Total size in bytes |

## How Timing Works

Each processor automatically records its build time. This happens transparently:

1. **Start**: When a processor begins, timestamp is captured
2. **End**: When a processor completes, duration is calculated
3. **Storage**: Timing data saved to `timing.json` (internal, not published)
4. **Aggregation**: Finalize reads all timing.json files and combines them

You don't need to do anything special - timing is automatic.

## Customizing Processor Output

By default, most processors don't publish their outputs. To change this, add to your seed.nix:

```nix
{
  name = "serde";
  version = "1.0.228";
  github = { ... };

  # Override default processor settings
  processors = {
    source-download = { persist = true; };  # Now publishes output
    stats = { enabled = false; };           # Disabled entirely
  };
}
```

When a processor has `persist = true`:
- Its `publish/` folder contents are copied alongside seed.nix
- It appears with a "view output" link in README.md
- bloom.json includes `fileCount`, `fileSize`, and `hash`

## Troubleshooting

### No README.md or bloom.json after build

The finalize processor only runs if **all other processors succeed**. Check for build errors:

```bash
nix build -f seed.nix 2>&1 | grep -i error
```

### Timing shows 0ms

Very fast operations (under 1ms) will show 0ms duration. This is normal.

### File counts seem wrong

File counts only include files in the `publish/` subfolder, not internal build metadata like `timing.json`.
